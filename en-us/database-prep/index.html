<!DOCTYPE html>

<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
		<meta http-equiv="x-ua-compatible" content="ie=edge">
		<meta property="og:title" content="Database Preparation - Docs"></meta>
 		
		<meta property="og:description" content="" />
		
		<meta property="og:type" content="article"></meta>
		<meta property="og:url" content="https://ertlans.github.io/en-us/database-prep/"></meta>
		<meta property="og:image" content="https://docs.gitea.io/images/gitea.png"></meta>
		<meta name="generator" content="Hugo 0.70.0" />

		<title>Database Preparation - Docs</title>

		
		

		

		<link rel="canonical" href="https://ertlans.github.io/en-us/database-prep/">

		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" />
		<link rel="stylesheet" href="https://ertlans.github.io/styles/main.css">

		<link rel="shortcut icon" type="image/x-icon" href="https://ertlans.github.io/images/favicon.png">
		<link rel="icon" type="image/x-icon" href="https://ertlans.github.io/images/favicon.png">
	</head>
	<body>

<nav class="navbar">
	<div class="container">
		<div class="navbar-brand">
			<a class="navbar-item" href="https://ertlans.github.io/">
				<img src="https://ertlans.github.io/images/gitea.png" alt="Docs">
			</a>
			<span class="navbar-burger burger" data-target="navMenu" aria-label="menu" aria-expanded="false">
              <span></span>
              <span></span>
              <span></span>
            </span>
		</div>
		<div class="navbar-menu" id="navMenu">
			<div class="navbar-end">
				<span class="navbar-item logo"><img src="https://ertlans.github.io/images/gitea.png" alt="Docs"></span>

	<a class="navbar-item" href="https://gitea.io/en-us/">
		<i class="fa fa-home"></i>&nbsp;
		Website
	</a>

	<a class="navbar-item" href="/en-us/">
		<i class="fa fa-question"></i>&nbsp;
		Docs
	</a>

	<a class="navbar-item" href="https://blog.gitea.io/">
		<i class="fa fa-rss"></i>&nbsp;
		Blog
	</a>

	<a class="navbar-item" href="https://code.gitea.io/">
		<i class="fa fa-code"></i>&nbsp;
		Code
	</a>

	<a class="navbar-item" href="https://crowdin.com/project/gitea">
		<i class="fa fa-language"></i>&nbsp;
		Translation
	</a>

	<a class="navbar-item" href="https://try.gitea.io/api/swagger">
		<i class="fa fa-plug"></i>&nbsp;
		API
	</a>

	<a class="navbar-item" href="https://dl.gitea.io/">
		<i class="fa fa-download"></i>&nbsp;
		Downloads
	</a>

	<a class="navbar-item" href="https://github.com/go-gitea/">
		<i class="fa fa-github"></i>&nbsp;
		GitHub
	</a>

	<a class="navbar-item" href="https://discord.gg/Gitea">
		<i class="fa fa-comment"></i>&nbsp;
		Discord Chat
	</a>

	<a class="navbar-item" href="https://discourse.gitea.io/">
		<i class="fa fa-group"></i>&nbsp;
		Forum
	</a>


			</div>
		</div>
		<div class="navbar-background" id="navbar-background"></div>
	</div>
</nav>

<section class="section">
	<div class="container is-centered page">
		<div class="columns">
			<div class="column is-one-quarter">
				<aside class="menu">
	
		
			<p class="menu-label">
				
				Help
			</p>
			<ul class="menu-list">
				
					<li>
						<a href="/en-us/faq/" >
							
							FAQ
						</a>
					</li>
				
					<li>
						<a href="/en-us/seek-help/" >
							
							Support Options
						</a>
					</li>
				
			</ul>
		
	
		
			<p class="menu-label">
				
				Installation
			</p>
			<ul class="menu-list">
				
					<li>
						<a href="/en-us/install-with-docker/" >
							
							With Docker
						</a>
					</li>
				
					<li>
						<a href="/en-us/database-prep/" class="is-active">
							
							Database preparation
						</a>
					</li>
				
					<li>
						<a href="/en-us/install-from-binary/" >
							
							From binary
						</a>
					</li>
				
					<li>
						<a href="/en-us/install-from-package/" >
							
							From package
						</a>
					</li>
				
					<li>
						<a href="/en-us/linux-service/" >
							
							Linux service
						</a>
					</li>
				
					<li>
						<a href="/en-us/install-from-source/" >
							
							From source
						</a>
					</li>
				
					<li>
						<a href="/en-us/windows-service/" >
							
							Windows Service
						</a>
					</li>
				
			</ul>
		
	
		
			<p class="menu-label">
				
				Upgrade
			</p>
			<ul class="menu-list">
				
					<li>
						<a href="/en-us/upgrade-from-gogs/" >
							
							From Gogs
						</a>
					</li>
				
			</ul>
		
	
		
			<p class="menu-label">
				
				Usage
			</p>
			<ul class="menu-list">
				
					<li>
						<a href="/en-us/command-line/" >
							
							Command Line
						</a>
					</li>
				
					<li>
						<a href="/en-us/backup-and-restore/" >
							
							Backup and Restore
						</a>
					</li>
				
					<li>
						<a href="/en-us/email-setup/" >
							
							Email setup
						</a>
					</li>
				
					<li>
						<a href="/en-us/pull-request/" >
							
							Pull Request
						</a>
					</li>
				
					<li>
						<a href="/en-us/automatically-linked-references/" >
							
							Automatically Linked References
						</a>
					</li>
				
					<li>
						<a href="/en-us/issue-pull-request-templates/" >
							
							Issue and Pull Request templates
						</a>
					</li>
				
					<li>
						<a href="/en-us/reverse-proxies/" >
							
							Reverse Proxies
						</a>
					</li>
				
			</ul>
		
	
		
			<p class="menu-label">
				
				Advanced
			</p>
			<ul class="menu-list">
				
					<li>
						<a href="/en-us/adding-legal-pages/" >
							
							Adding Legal Pages
						</a>
					</li>
				
					<li>
						<a href="/en-us/customizing-gitea/" >
							
							Customizing Gitea
						</a>
					</li>
				
					<li>
						<a href="/en-us/hacking-on-gitea/" >
							
							Hacking on Gitea
						</a>
					</li>
				
					<li>
						<a href="/en-us/config-cheat-sheet/" >
							
							Config Cheat Sheet
						</a>
					</li>
				
					<li>
						<a href="/en-us/signing/" >
							
							GPG Commit Signatures
						</a>
					</li>
				
					<li>
						<a href="/en-us/specific-variables/" >
							
							Specific variables
						</a>
					</li>
				
					<li>
						<a href="/en-us/make/" >
							
							Make
						</a>
					</li>
				
					<li>
						<a href="/en-us/api-usage/" >
							
							API Usage
						</a>
					</li>
				
					<li>
						<a href="/en-us/ci-cd/" >
							
							CI/CD Usage
						</a>
					</li>
				
					<li>
						<a href="/en-us/cmd-embedded/" >
							
							Embedded data extraction tool
						</a>
					</li>
				
					<li>
						<a href="/en-us/external-renderers/" >
							
							External renderers
						</a>
					</li>
				
					<li>
						<a href="/en-us/repo-indexer/" >
							
							Repository indexer
						</a>
					</li>
				
					<li>
						<a href="/en-us/third-party-tools/" >
							
							Third Party Tools
						</a>
					</li>
				
					<li>
						<a href="/en-us/logging-configuration/" >
							
							Logging Configuration
						</a>
					</li>
				
					<li>
						<a href="/en-us/migrations-interfaces/" >
							
							Migrations Interfaces
						</a>
					</li>
				
					<li>
						<a href="/en-us/search-engines-indexation/" >
							
							Search Engines Indexation
						</a>
					</li>
				
			</ul>
		
	
		
			<p class="menu-label">
				
				features
			</p>
			<ul class="menu-list">
				
					<li>
						<a href="/en-us/comparison/" >
							
							Comparison
						</a>
					</li>
				
					<li>
						<a href="/en-us/authentication/" >
							
							Authentication
						</a>
					</li>
				
					<li>
						<a href="/en-us/localization/" >
							
							Localization
						</a>
					</li>
				
					<li>
						<a href="/en-us/webhooks/" >
							
							Webhooks
						</a>
					</li>
				
			</ul>
		
	
	</ul>
</aside>


	



			</div>
			<div class="column is-three-quarters">
				<div class="content">
					<p>You need a database to use Gitea. Gitea supports PostgreSQL, MySQL, SQLite, and MSSQL. This page will guide into preparing database. Only PostgreSQL and MySQL will be covered here since those database engines are widely-used in production.</p>
<p>Database instance can be on same machine as Gitea (local database setup), or on different machine (remote database).</p>
<p>Note: All steps below requires that the database engine of your choice is installed on your system. For remote database setup, install the server part on database instance and client part on your Gitea server. In addition, make sure you use same engine version for both server and client for some engine features to work. For security reason, protect <code>root</code> (MySQL) or <code>postgres</code> (PostgreSQL) database superuser with secure password.  The steps assumes that you run Linux for both database and Gitea servers.</p>
<h2 id="mysql">MySQL</h2>
<ol>
<li>
<p>On database instance, login to database console as root:</p>
<pre><code>mysql -u root -p
</code></pre><p>Enter the password as prompted.</p>
</li>
<li>
<p>Create database user which will be used by Gitea, authenticated by password. This example uses <code>'gitea'</code> as password. Please use a secure password for your instance.</p>
<p>For local database:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">SET</span> old_passwords<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>;
<span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">USER</span> <span style="color:#e6db74">&#39;gitea&#39;</span> IDENTIFIED <span style="color:#66d9ef">BY</span> <span style="color:#e6db74">&#39;gitea&#39;</span>;
</code></pre></div><p>For remote database:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">SET</span> old_passwords<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>;
<span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">USER</span> <span style="color:#e6db74">&#39;gitea&#39;</span><span style="color:#f92672">@</span><span style="color:#e6db74">&#39;192.0.2.10&#39;</span> IDENTIFIED <span style="color:#66d9ef">BY</span> <span style="color:#e6db74">&#39;gitea&#39;</span>;
</code></pre></div><p>where <code>192.0.2.10</code> is the IP address of your Gitea instance.</p>
<p>Replace username and password above as appropriate.</p>
</li>
<li>
<p>Create database with UTF-8 charset and collation. Make sure to use <code>utf8mb4</code> charset instead of <code>utf8</code> as the former supports all Unicode characters (including emojis) beyond <em>Basic Multilingual Plane</em>. Also, collation chosen depending on your expected content. When in doubt, use either <code>unicode_ci</code> or <code>general_ci</code>.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">DATABASE</span> giteadb CHARACTER <span style="color:#66d9ef">SET</span> <span style="color:#e6db74">&#39;utf8mb4&#39;</span> <span style="color:#66d9ef">COLLATE</span> <span style="color:#e6db74">&#39;utf8mb4_unicode_ci&#39;</span>;
</code></pre></div><p>Replace database name as appropriate.</p>
</li>
<li>
<p>Grant all privileges on the database to database user created above.</p>
<p>For local database:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">GRANT</span> <span style="color:#66d9ef">ALL</span> <span style="color:#66d9ef">PRIVILEGES</span> <span style="color:#66d9ef">ON</span> giteadb.<span style="color:#f92672">*</span> <span style="color:#66d9ef">TO</span> <span style="color:#e6db74">&#39;gitea&#39;</span>;
FLUSH <span style="color:#66d9ef">PRIVILEGES</span>;
</code></pre></div><p>For remote database:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">GRANT</span> <span style="color:#66d9ef">ALL</span> <span style="color:#66d9ef">PRIVILEGES</span> <span style="color:#66d9ef">ON</span> giteadb.<span style="color:#f92672">*</span> <span style="color:#66d9ef">TO</span> <span style="color:#e6db74">&#39;gitea&#39;</span><span style="color:#f92672">@</span><span style="color:#e6db74">&#39;192.0.2.10&#39;</span>;
FLUSH <span style="color:#66d9ef">PRIVILEGES</span>;
</code></pre></div></li>
<li>
<p>Quit from database console by <code>exit</code>.</p>
</li>
<li>
<p>On your Gitea server, test connection to the database:</p>
<pre><code>mysql -u gitea -h 203.0.113.3 -p giteadb
</code></pre><p>where <code>gitea</code> is database username, <code>giteadb</code> is database name, and <code>203.0.113.3</code> is IP address of database instance. Omit <code>-h</code> option for local database.</p>
<p>You should be connected to the database.</p>
</li>
</ol>
<h2 id="postgresql">PostgreSQL</h2>
<ol>
<li>
<p>PostgreSQL uses <code>md5</code> challenge-response encryption scheme for password authentication by default. Nowadays this scheme is not considered secure anymore. Use SCRAM-SHA-256 scheme instead by editing the <code>postgresql.conf</code> configuration file on the database server to:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ini" data-lang="ini"><span style="color:#a6e22e">password_encryption</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">scram-sha-256</span>
</code></pre></div><p>Restart PostgreSQL to apply the setting.</p>
</li>
<li>
<p>On the database server, login to the database console as superuser:</p>
<pre><code>su -c &quot;psql&quot; - postgres
</code></pre></li>
<li>
<p>Create database user (role in PostgreSQL terms) with login privilege and password. Please use a secure, strong password instead of <code>'gitea'</code> below:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">ROLE</span> gitea <span style="color:#66d9ef">WITH</span> LOGIN PASSWORD <span style="color:#e6db74">&#39;gitea&#39;</span>;
</code></pre></div><p>Replace username and password as appropriate.</p>
</li>
<li>
<p>Create database with UTF-8 charset and owned by the database user created earlier. Any <code>libc</code> collations can be specified with <code>LC_COLLATE</code> and <code>LC_CTYPE</code> parameter, depending on expected content:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">DATABASE</span> giteadb <span style="color:#66d9ef">WITH</span> <span style="color:#66d9ef">OWNER</span> gitea <span style="color:#66d9ef">TEMPLATE</span> template0 <span style="color:#66d9ef">ENCODING</span> UTF8 LC_COLLATE <span style="color:#e6db74">&#39;en_US.UTF-8&#39;</span> LC_CTYPE <span style="color:#e6db74">&#39;en_US.UTF-8&#39;</span>;
</code></pre></div><p>Replace database name as appropriate.</p>
</li>
<li>
<p>Allow the database user to access the database created above by adding the following authentication rule to <code>pg_hba.conf</code>.</p>
<p>For local database:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ini" data-lang="ini"><span style="color:#a6e22e">local    giteadb    gitea    scram-sha-256</span>
</code></pre></div><p>For remote database:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ini" data-lang="ini"><span style="color:#a6e22e">host    giteadb    gitea    192.0.2.10/32    scram-sha-256</span>
</code></pre></div><p>Replace database name, user, and IP address of Gitea instance with your own.</p>
<p>Note: rules on <code>pg_hba.conf</code> are evaluated sequentially, that is the first matching rule will be used for authentication. Your PostgreSQL installation may come with generic authentication rules that match all users and databases. You may need to place the rules presented here above such generic rules if it is the case.</p>
<p>Restart PostgreSQL to apply new authentication rules.</p>
</li>
<li>
<p>On your Gitea server, test connection to the database.</p>
<p>For local database:</p>
<pre><code>psql -U gitea -d giteadb
</code></pre><p>For remote database:</p>
<pre><code>psql &quot;postgres://gitea@203.0.113.3/giteadb&quot;
</code></pre><p>where <code>gitea</code> is database user, <code>giteadb</code> is database name, and <code>203.0.113.3</code> is IP address of your database instance.</p>
<p>You should be prompted to enter password for the database user, and connected to the database.</p>
</li>
</ol>
<h2 id="database-connection-over-tls">Database Connection over TLS</h2>
<p>If the communication between Gitea and your database instance is performed through a private network, or if Gitea and the database are running on the same server, this section can be omitted since the security between Gitea and the database instance is not critically exposed. If instead the database instance is on a public network, use TLS to encrypt the connection to the database, as it is possible for third-parties to intercept the traffic data.</p>
<h3 id="prerequisites">Prerequisites</h3>
<ul>
<li>You need two valid TLS certificates, one for the database instance (database server) and one for the Gitea instance (database client). Both certificates must be signed by a trusted CA.</li>
<li>The database certificate must contain <code>TLS Web Server Authentication</code> in the <code>X509v3 Extended Key Usage</code> extension attribute, while the client certificate needs <code>TLS Web Client Authentication</code> in the corresponding attribute.</li>
<li>On the database server certificate, one of <code>Subject Alternative Name</code> or <code>Common Name</code> entries must be the fully-qualified domain name (FQDN) of the database instance (e.g. <code>db.example.com</code>). On the database client certificate, one of the entries mentioned above must contain the database username that Gitea will be using to connect.</li>
<li>You need domain name mappings of both Gitea and database servers to their respective IP addresses. Either set up DNS records for them or add local mappings to <code>/etc/hosts</code> (<code>%WINDIR%\System32\drivers\etc\hosts</code> in Windows) on each system. This allows the database connections to be performed by domain name instead of IP address. See documentation of your system for details.</li>
</ul>
<h3 id="postgresql-1">PostgreSQL</h3>
<p>The PostgreSQL driver used by Gitea supports two-way TLS. In two-way TLS, both database client and server authenticate each other by sending their respective certificates to their respective opposite for validation. In other words, the server verifies client certificate, and the client verifies server certificate.</p>
<ol>
<li>
<p>On the server with the database instance, place the following credentials:</p>
<ul>
<li><code>/path/to/postgresql.crt</code>: Database instance certificate</li>
<li><code>/path/to/postgresql.key</code>: Database instance private key</li>
<li><code>/path/to/root.crt</code>: CA certificate chain to validate client certificates</li>
</ul>
</li>
<li>
<p>Add following options to <code>postgresql.conf</code>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ini" data-lang="ini"><span style="color:#a6e22e">ssl</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">on</span>
<span style="color:#a6e22e">ssl_ca_file</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;/path/to/root.crt&#39;</span>
<span style="color:#a6e22e">ssl_cert_file</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;/path/to/postgresql.crt&#39;</span>
<span style="color:#a6e22e">ssl_key_file</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;/path/to/postgresql.key&#39;</span>
<span style="color:#a6e22e">ssl_min_protocol_version</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;TLSv1.2&#39;</span>
</code></pre></div></li>
<li>
<p>Adjust credentials ownership and permission, as required by PostgreSQL:</p>
<pre><code>chown postgres:postgres /path/to/root.crt /path/to/postgresql.crt /path/to/postgresql.key
chmod 0600 /path/to/root.crt /path/to/postgresql.crt /path/to/postgresql.key
</code></pre></li>
<li>
<p>Edit <code>pg_hba.conf</code> rule to only allow Gitea database user to connect over SSL, and to require client certificate verification.</p>
<p>For PostgreSQL 12:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ini" data-lang="ini"><span style="color:#a6e22e">hostssl    giteadb    gitea    192.0.2.10/32    scram-sha-256    clientcert</span><span style="color:#f92672">=</span><span style="color:#e6db74">verify-full</span>
</code></pre></div><p>For PostgreSQL 11 and earlier:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ini" data-lang="ini"><span style="color:#a6e22e">hostssl    giteadb    gitea    192.0.2.10/32    scram-sha-256    clientcert</span><span style="color:#f92672">=</span><span style="color:#e6db74">1</span>
</code></pre></div><p>Replace database name, user, and IP address of Gitea instance as appropriate.</p>
</li>
<li>
<p>Restart PostgreSQL to apply configurations above.</p>
</li>
<li>
<p>On the server running the Gitea instance, place the following credentials under the home directory of the user who runs Gitea (e.g. <code>git</code>):</p>
<ul>
<li><code>~/.postgresql/postgresql.crt</code>: Database client certificate</li>
<li><code>~/.postgresql/postgresql.key</code>: Database client private key</li>
<li><code>~/.postgresql/root.crt</code>: CA certificate chain to validate server certificate</li>
</ul>
<p>Note: Those file names above are hardcoded in PostgreSQL and it is not possible to change them.</p>
</li>
<li>
<p>Adjust credentials, ownership and permission as required:</p>
<pre><code>chown git:git ~/.postgresql/postgresql.crt ~/.postgresql/postgresql.key ~/.postgresql/root.crt
chown 0600 ~/.postgresql/postgresql.crt ~/.postgresql/postgresql.key ~/.postgresql/root.crt
</code></pre></li>
<li>
<p>Test the connection to the database:</p>
<pre><code>psql &quot;postgres://gitea@example.db/giteadb?sslmode=verify-full&quot;
</code></pre><p>You should be prompted to enter password for the database user, and then be connected to the database.</p>
</li>
</ol>
<h3 id="mysql-1">MySQL</h3>
<p>While the MySQL driver used by Gitea also supports two-way TLS, Gitea currently supports only one-way TLS. See issue #10828 for details.</p>
<p>In one-way TLS, the database client verifies the certificate sent from server during the connection handshake, and the server assumes that the connected client is legitimate, since client certificate verification doesn&rsquo;t take place.</p>
<ol>
<li>
<p>On the database instance, place the following credentials:</p>
<ul>
<li><code>/path/to/mysql.crt</code>: Database instance certificate</li>
<li><code>/path/to/mysql.key</code>: Database instance key</li>
<li><code>/path/to/ca.crt</code>: CA certificate chain. This file isn&rsquo;t used on one-way TLS, but is used to validate client certificates on two-way TLS.</li>
</ul>
</li>
<li>
<p>Add following options to <code>my.cnf</code>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ini" data-lang="ini"><span style="color:#66d9ef">[mysqld]</span>
<span style="color:#a6e22e">ssl-ca</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">/path/to/ca.crt</span>
<span style="color:#a6e22e">ssl-cert</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">/path/to/mysql.crt</span>
<span style="color:#a6e22e">ssl-key</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">/path/to/mysql.key</span>
<span style="color:#a6e22e">tls-version</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">TLSv1.2,TLSv1.3</span>
</code></pre></div></li>
<li>
<p>Adjust credentials ownership and permission:</p>
<pre><code>chown mysql:mysql /path/to/ca.crt /path/to/mysql.crt /path/to/mysql.key
chmod 0600 /path/to/ca.crt /path/to/mysql.crt /path/to/mysql.key
</code></pre></li>
<li>
<p>Restart MySQL to apply the setting.</p>
</li>
<li>
<p>The database user for Gitea may have been created earlier, but it would authenticate only against the IP addresses of the server running Gitea. To authenticate against its domain name, recreate the user, and this time also set it to require TLS for connecting to the database:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">DROP</span> <span style="color:#66d9ef">USER</span> <span style="color:#e6db74">&#39;gitea&#39;</span><span style="color:#f92672">@</span><span style="color:#e6db74">&#39;192.0.2.10&#39;</span>;
<span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">USER</span> <span style="color:#e6db74">&#39;gitea&#39;</span><span style="color:#f92672">@</span><span style="color:#e6db74">&#39;example.gitea&#39;</span> IDENTIFIED <span style="color:#66d9ef">BY</span> <span style="color:#e6db74">&#39;gitea&#39;</span> REQUIRE SSL;
<span style="color:#66d9ef">GRANT</span> <span style="color:#66d9ef">ALL</span> <span style="color:#66d9ef">PRIVILEGES</span> <span style="color:#66d9ef">ON</span> giteadb.<span style="color:#f92672">*</span> <span style="color:#66d9ef">TO</span> <span style="color:#e6db74">&#39;gitea&#39;</span><span style="color:#f92672">@</span><span style="color:#e6db74">&#39;example.gitea&#39;</span>;
FLUSH <span style="color:#66d9ef">PRIVILEGES</span>;
</code></pre></div><p>Replace database user name, password, and Gitea instance domain as appropriate.</p>
</li>
<li>
<p>Make sure that the CA certificate chain required to validate the database server certificate is on the system certificate store of both the database and Gitea servers. Consult your system documentation for instructions on adding a CA certificate to the certificate store.</p>
</li>
<li>
<p>On the server running Gitea, test connection to the database:</p>
<pre><code>mysql -u gitea -h example.db -p --ssl
</code></pre><p>You should be connected to the database.</p>
</li>
</ol>

				</div>
			</div>
		</div>
	</div>
</section>

		<footer class="footer">
			<div class="container">
				<div class="content has-text-centered">
					<p>
						Copyright &copy; 2020 <a href="https://docs.gitea.io">The Gitea Authors</a>. All rights reserved. Made with <i class="fa fa-heart" aria-hidden="true"></i> and <a href="https://gohugo.io">Hugo</a>.
					</p>
					<p>
						 Sponsored by <a href="https://www.didiyun.com">DiDi Cloud</a>, <a href="http://inblockchain.com">INBlockchain</a>, <a href="https://www.packet.com">Packet</a>, <a href="https://digitalocean.com">DigitalOcean</a>, and all of our backers on <a href="https://opencollective.com/gitea">Open Collective</a>.
					</p>
					<p>
						
						<a class="nav-link" href="https://ertlans.github.io/zh-cn" hreflang="zh-cn">中文(简体)</a>
						
						<a class="nav-link" href="https://ertlans.github.io/zh-tw" hreflang="zh-tw">中文(繁體)</a>
						
						<a class="nav-link" href="https://ertlans.github.io/pt-br" hreflang="pt-br">Português Brasileiro</a>
						
						<a class="nav-link" href="https://ertlans.github.io/nl-nl" hreflang="nl-nl">Nederlands</a>
						
						<a class="nav-link" href="https://ertlans.github.io/en-us" hreflang="en-us">English</a>
						
						<a class="nav-link" href="https://ertlans.github.io/fr-fr" hreflang="fr-fr">Français</a>
						
					</p>
				</div>
			</div>
		</footer>

		<script>
            document.addEventListener('DOMContentLoaded', function () {

                
                var $navbarBurgers = Array.prototype.slice.call(document.querySelectorAll('.navbar-burger'), 0);

                
                if ($navbarBurgers.length > 0) {

                    
                    $navbarBurgers.forEach(function ($el) {
                        $el.addEventListener('click', function () {

                            
                            var target = $el.dataset.target;
                            var $target = document.getElementById(target);

                            
                            $el.classList.toggle('is-active');
                            $target.classList.toggle('is-active');


                            document.getElementById('navbar-background').classList.toggle('is-active');


                        });
                    });
                }

				
				
				let svg = '  <svg version="1.1" xmlns="http://www.w3.org/2000/svg" style="fill: currentColor; vertical-align: middle" width="24" height="24" viewBox="0 0 32 32"><title>gitea</title><path d="M5.583 7.229c-2.464-0.005-5.755 1.557-5.573 5.479 0.281 6.125 6.557 6.693 9.068 6.745 0.271 1.146 3.224 5.109 5.411 5.318h9.573c5.74-0.38 10.036-17.365 6.854-17.427-5.271 0.25-8.396 0.375-11.073 0.396v5.297l-0.839-0.365-0.005-4.932c-3.073 0-5.781-0.141-10.917-0.396-0.646-0.005-1.542-0.115-2.5-0.115zM5.927 9.396h0.297c0.349 3.141 0.917 4.974 2.068 7.781-2.938-0.349-5.432-1.198-5.891-4.38-0.24-1.646 0.563-3.365 3.526-3.401zM17.339 12.479c0.198 0.005 0.406 0.042 0.594 0.13l1 0.432-0.714 1.302c-0.109 0-0.219 0.016-0.323 0.052-0.464 0.151-0.708 0.604-0.542 1.021 0.036 0.083 0.089 0.161 0.151 0.229l-1.234 2.25c-0.099 0-0.203 0.016-0.297 0.052-0.464 0.146-0.708 0.604-0.542 1.016 0.172 0.417 0.682 0.63 1.151 0.479 0.464-0.146 0.703-0.604 0.536-1.021-0.047-0.109-0.115-0.208-0.208-0.292l1.203-2.188c0.13 0.010 0.26 0 0.391-0.042 0.104-0.031 0.198-0.083 0.281-0.151 0.464 0.198 0.844 0.354 1.12 0.49 0.406 0.203 0.552 0.339 0.599 0.49 0.042 0.146-0.005 0.427-0.24 0.922-0.172 0.37-0.458 0.896-0.797 1.51-0.115 0-0.229 0.016-0.333 0.052-0.469 0.151-0.708 0.604-0.542 1.021 0.167 0.411 0.682 0.625 1.146 0.479 0.469-0.151 0.708-0.604 0.542-1.021-0.042-0.099-0.104-0.193-0.182-0.271 0.333-0.609 0.62-1.135 0.807-1.526 0.25-0.536 0.38-0.938 0.266-1.323s-0.469-0.635-0.932-0.865c-0.307-0.151-0.693-0.313-1.146-0.505 0.005-0.109-0.010-0.214-0.052-0.318s-0.109-0.198-0.193-0.281l0.703-1.281 3.901 1.682c0.703 0.307 0.995 1.057 0.651 1.682l-2.682 4.906c-0.339 0.625-1.182 0.885-1.885 0.578l-5.516-2.38c-0.703-0.307-0.995-1.057-0.656-1.682l2.682-4.906c0.234-0.432 0.708-0.688 1.208-0.708h0.083z"></path></svg>';
				let contents = document.getElementsByClassName("content");
				if (contents.length > 0) {
					let content = contents[0];
					for (let level = 1; level <= 4; level++) {
						let elems = content.getElementsByTagName("h" + level);
						for (let i = 0; i < elems.length; i++) {
							let elem = elems[i];
							if (elem.id !== "undefined" && elem.id !== "") {
								let anchorId = elem.id + "-anchor";
								elem.addEventListener("mouseover", () => {
									document.getElementById(anchorId).style.display = "initial";
								});
								elem.addEventListener("mouseout", () => {
									document.getElementById(anchorId).style.display = "none";
								});
								let anchor = document.createElement("a");
								anchor.id = anchorId;
								anchor.href = "#" + elem.id;
								anchor.innerHTML = svg;
								anchor.style.display = "none";
								elem.appendChild(anchor);
							}
						}
					}
				}

            });
		</script>

		</body>
</html>

